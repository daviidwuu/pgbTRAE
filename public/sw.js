(()=>{let e=[{'revision':'ce687e1318ba1d1832a180d8ac5e1e4c','url':'/_next/app-build-manifest.json'},{'revision':'d434f639599941f0c61d211e820095ad','url':'/_next/react-loadable-manifest.json'},{'revision':'11711fd20dc88179b01f8f3ec71f2b2c','url':'/_next/server/app/_not-found/page_client-reference-manifest.js'},{'revision':'1300cf1a1f4a417095b04440737a942f','url':'/_next/server/app/api/push-subscriptions/route_client-reference-manifest.js'},{'revision':'ca3e903147d1ff02f65d14a94ca57ec4','url':'/_next/server/app/api/transactions/route_client-reference-manifest.js'},{'revision':'a2bed1bdf1d1eb6ec97ed8f21f910cdb','url':'/_next/server/app/icon.png/route_client-reference-manifest.js'},{'revision':'7ae06f36d055a97382d95eb090a70006','url':'/_next/server/app/login/page_client-reference-manifest.js'},{'revision':'2de82fae61746e77a6b774022c26a8d6','url':'/_next/server/app/page_client-reference-manifest.js'},{'revision':'2808da8196d6bbfb6caaa946d9cb3b37','url':'/_next/server/middleware-build-manifest.js'},{'revision':'0a38705b2f135f6365486bc3b44869cd','url':'/_next/server/middleware-react-loadable-manifest.js'},{'revision':'02ca660aea97f81d8955b16919d666b1','url':'/_next/server/next-font-manifest.js'},{'revision':'67e65b114f35c2d0022869568ee5f8f8','url':'/_next/server/next-font-manifest.json'},{'revision':'11a7483ef6ed3488','url':'/_next/static/chunks/145.11a7483ef6ed3488.js'},{'revision':'ea5fd03686dd1aa4','url':'/_next/static/chunks/2.ea5fd03686dd1aa4.js'},{'revision':'528756debd6e3879','url':'/_next/static/chunks/213.528756debd6e3879.js'},{'revision':'584d69e946f1eae7','url':'/_next/static/chunks/229.584d69e946f1eae7.js'},{'revision':'38842713707f0c9c','url':'/_next/static/chunks/258.38842713707f0c9c.js'},{'revision':'e5c24054988c815c','url':'/_next/static/chunks/408.e5c24054988c815c.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/453-3275e9161109e4d7.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/4bd1b696-4419cc93057fcf32.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/521-db95f383a4a1c59f.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/663-b5afdf5dfd8cb0e0.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/684-7002d2f60d48787d.js'},{'revision':'ce5e9d2a78a8a51b','url':'/_next/static/chunks/700.ce5e9d2a78a8a51b.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/734-4a063e1005909446.js'},{'revision':'13bb3ea5bd3729a4','url':'/_next/static/chunks/75.13bb3ea5bd3729a4.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/761-c6d80d4cf26a2517.js'},{'revision':'b27e99e9bf3f2444','url':'/_next/static/chunks/933.b27e99e9bf3f2444.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/app/_not-found/page-a3cc41667356e2de.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/app/api/push-subscriptions/route-ba0cf07c9da92d9d.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/app/api/transactions/route-de855772ccffda0b.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/app/icon.png/route-143fdd39ae4351bd.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/app/layout-08af5d7a510bce42.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/app/login/page-53e18fc3b086040b.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/app/page-599653e1710c5fb4.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/bc9e92e6-fb72ec34e6b7adae.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/ceb9e9aa-90ba92655eafb5a6.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/framework-6d868e9bc95e10d8.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/main-4396f03206d7ec6f.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/main-app-e636998258664939.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/pages/_app-da15c11dea942c36.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/pages/_error-cc3f077a18ea1793.js'},{'revision':'846118c33b2c0e922d7b3a7676f81f6f','url':'/_next/static/chunks/polyfills-42372ed130431b0a.js'},{'revision':'OtzZ7Hxyy6D7zv3jyyehG','url':'/_next/static/chunks/webpack-d2cfad15c487ddc3.js'},{'revision':'020f68e06fe67b16','url':'/_next/static/css/020f68e06fe67b16.css'},{'revision':'be8ee93a8cf390eb9cb6e6aadf1a3bf0','url':'/_next/static/media/24c15609eaa28576-s.woff2'},{'revision':'399fb80a20ea7d2a53a1d6dc1e5f392a','url':'/_next/static/media/2c07349e02a7b712-s.woff2'},{'revision':'4746809ed1c17447d45d2a96c64796d4','url':'/_next/static/media/47cbc4e2adbc5db9-s.p.woff2'},{'revision':'c46f88e9518178fd56311db461452f8d','url':'/_next/static/media/627d916fd739a539-s.woff2'},{'revision':'99ebacc4dfd7bd21bf48d21306c0dd42','url':'/_next/static/media/74c003a2abab0c4f-s.woff2'},{'revision':'bdf2a9a2d904dc21d9b593b82887af52','url':'/_next/static/media/84602850c8fd81c3-s.woff2'},{'revision':'5489c188e786a745bd9ba1bc9fbf7f71','url':'/_next/static/media/90da053edc2b7de3-s.woff2'},{'revision':'9df032a6b99e0fce98ec4ad311b0fd7d','url':'/_next/static/media/ac3b7908202f8517-s.woff2'},{'revision':'6f64aa964b323b9c0e5dbce214081225','url':'/_next/static/media/b5ee789b512e4d1b-s.woff2'},{'revision':'bd711f7e9ef9b234cd10570055c44e91','url':'/icon.png'},{'revision':'94a208567b27ee2ee4fee63e53311710','url':'/manifest.json'}]||[];self.addEventListener("install",t=>{console.log("[SW] Installing service worker with precache manifest"),t.waitUntil(caches.open("precache-v1").then(t=>t.addAll(e.map(e=>e.url)))),self.skipWaiting()}),self.addEventListener("activate",e=>{console.log("[SW] Activating service worker"),e.waitUntil(self.clients.claim())}),self.addEventListener("fetch",e=>{let{request:t}=e,i=new URL(t.url);return"fonts.googleapis.com"===i.hostname||"fonts.gstatic.com"===i.hostname?void e.respondWith(caches.open("google-fonts-cache").then(e=>e.match(t).then(i=>i||fetch(t).then(i=>(e.put(t,i.clone()),i))))):"image"===t.destination?void e.respondWith(caches.open("images-cache").then(e=>e.match(t).then(i=>{let a=fetch(t).then(i=>(e.put(t,i.clone()),i));return i||a}))):i.pathname.startsWith("/api/")?void e.respondWith(fetch(t).then(e=>{if(e.ok){let i=e.clone();caches.open("api-cache").then(e=>{e.put(t,i)})}return e}).catch(()=>caches.match(t))):void e.respondWith(caches.match(t).then(e=>e||fetch(t)))}),(()=>{let e="push-subscription-metadata",t=new Request("/__push_subscription_metadata__");function i(){if("undefined"==typeof navigator)return!1;let e=navigator.userAgent||"";return/iPad|iPhone|iPod/.test(e)&&/Safari/.test(e)&&!/CriOS|FxiOS/.test(e)}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;console.log("[SW Push - iOS] ".concat(e),t),t&&t.error&&console.error("[SW Push Error - iOS]",t.error)}async function n(n){if(!n||"object"!=typeof n)return void a("Invalid metadata payload",{payload:n});let{userId:r,vapidPublicKey:o}=n;if("string"!=typeof r||"string"!=typeof o)return void a("Invalid metadata format",{userId:typeof r,vapidPublicKey:typeof o});try{let n=await caches.open(e),s={userId:r,vapidPublicKey:o,isIOSSafari:i(),timestamp:Date.now()};await n.put(t,new Response(JSON.stringify(s),{headers:{"Content-Type":"application/json"}})),a("Metadata stored successfully",s)}catch(e){a("Failed to store metadata",{error:e})}}async function r(){try{let i=await caches.open(e),n=await i.match(t);if(!n)return a("No metadata found in cache"),null;let r=await n.json();return a("Metadata read successfully",r),r}catch(e){return a("Failed to read metadata",{error:e}),null}}async function o(e,t,n){if(!e||"string"!=typeof e.userId)throw Error("Missing user metadata for push subscription persistence.");let r=t.toJSON(),o={userId:e.userId,subscription:r,isIOSSafari:i(),userAgent:navigator.userAgent,timestamp:Date.now()};n&&(o.oldEndpoint=n),a("Persisting subscription to server",{userId:e.userId,isIOSSafari:o.isIOSSafari});try{let e=await fetch("/api/push-subscriptions",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-iOS-Safari":i()?"true":"false"},body:JSON.stringify(o)});if(!e.ok)throw Error("Failed to persist subscription: ".concat(e.status," - ").concat(e.statusText));a("Subscription persisted successfully")}catch(e){throw a("Failed to persist subscription",{error:e}),e}}async function s(e){try{let t=await self.clients.matchAll({type:"window",includeUncontrolled:!0}),n={type:"PUSH_SUBSCRIPTION_CHANGE",payload:{...e,isIOSSafari:i(),timestamp:Date.now()}};for(let e of(a("Broadcasting to ".concat(t.length," clients"),n),t))e.postMessage(n)}catch(e){a("Failed to broadcast subscription change",{error:e})}}self.addEventListener("push",e=>{let t;a("Push event received",{hasData:!!e.data});try{t=e.data?e.data.json():{},a("Push data parsed",t)}catch(e){a("Failed to parse push data",{error:e}),t={title:"piggybank",body:"New notification"}}let n={body:t.body||"New transaction recorded",icon:"/icon.png",badge:"/icon.png",tag:"piggybank-notification",requireInteraction:!1,silent:!1,data:{url:t.url||"/",timestamp:Date.now(),isIOSSafari:i()}};i()&&(n.actions=[{action:"view",title:"View Transaction"}]);let r=t.title||"piggybank";a("Showing notification",{title:r,options:n}),e.waitUntil(self.registration.showNotification(r,n).then(()=>{a("Notification shown successfully")}).catch(e=>{a("Failed to show notification",{error:e})}))}),self.addEventListener("notificationclick",e=>{var t;a("Notification clicked",{action:e.action,data:e.notification.data}),e.notification.close();let n=(null==(t=e.notification.data)?void 0:t.url)||"/";e.waitUntil(self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(e=>{let t=e.find(e=>e.url.includes(self.location.origin));return t?(a("Focusing existing client"),t.focus().then(()=>{t.postMessage({type:"NOTIFICATION_CLICKED",url:n,isIOSSafari:i()})})):(a("Opening new client",{url:n}),self.clients.openWindow(n))}).catch(e=>{a("Failed to handle notification click",{error:e})}))}),self.addEventListener("pushsubscriptionchange",e=>{a("Push subscription changed"),e.waitUntil(r().then(t=>{if(!t)return void a("No metadata available for subscription change");let n=function(e){let t="=".repeat((4-e.length%4)%4),i=atob((e+t).replace(/-/g,"+").replace(/_/g,"/")),a=new Uint8Array(i.length);for(let e=0;e<i.length;++e)a[e]=i.charCodeAt(e);return a}(t.vapidPublicKey);return self.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n}).then(i=>{var n;return a("New subscription created",{endpoint:i.endpoint}),o(t,i,null==(n=e.oldSubscription)?void 0:n.endpoint)}).then(()=>s({type:"subscription_renewed",isIOSSafari:i()}))}).catch(e=>(a("Failed to handle subscription change",{error:e}),s({type:"subscription_error",error:e.message,isIOSSafari:i()}))))}),self.addEventListener("message",e=>{e.data&&"STORE_PUSH_METADATA"===e.data.type&&(a("Received metadata storage request",e.data.payload),e.waitUntil(n(e.data.payload)))}),self.addEventListener("error",e=>{a("Service Worker error",{error:e.error,filename:e.filename,lineno:e.lineno})}),self.addEventListener("unhandledrejection",e=>{a("Unhandled promise rejection",{reason:e.reason})})})()})();